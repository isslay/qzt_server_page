<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.qzt.ump.dao.mapper.SysUserMapper">
    <!-- 通用查询映射结果 -->
    <resultMap id="BaseResultMap" type="com.qzt.ump.model.SysUserModel">
        <result column="id_" property="id"/>
        <result column="is_del" property="isDel"/>
        <result column="enable_" property="enable"/>
        <result column="remark_" property="remark"/>
        <result column="create_time" property="createTime"/>
        <result column="create_by" property="createBy"/>
        <result column="update_time" property="updateTime"/>
        <result column="update_by" property="updateBy"/>
        <result column="account_" property="account"/>
        <result column="password_" property="password"/>
        <result column="user_type" property="userType"/>
        <result column="user_name" property="userName"/>
        <result column="name_pinyin" property="namePinyin"/>
        <result column="sex_" property="sex"/>
        <result column="avatar_" property="avatar"/>
        <result column="phone_" property="phone"/>
        <result column="email_" property="email"/>
        <result column="id_card" property="idCard"/>
        <result column="wei_xin" property="weiXin"/>
        <result column="wei_bo" property="weiBo"/>
        <result column="qq_" property="qq"/>
        <result column="birth_day" property="birthDay"/>
        <result column="dept_id" property="deptId"/>
        <result column="position_" property="position"/>
        <result column="address_" property="address"/>
        <result column="staff_no" property="staffNo"/>
        <result column="deptName" property="deptName"/>
    </resultMap>
    <select id="selectPage" resultMap="BaseResultMap">
        SELECT u.*,d.dept_name as deptName
        FROM dgm_sys_user u left join dgm_sys_dept d on u.dept_id = d.id_
        where u.is_del=0
        <if test="searchKey != null">
            AND (u.user_name like "%"#{searchKey}"%" OR phone_ like "%"#{searchKey}"%" OR account_ like "%"#{searchKey}"%" )
        </if>
    </select>
    <select id="selectOne" resultMap="BaseResultMap">
        SELECT u.*,d.dept_name as deptName
        FROM dgm_sys_user u left join dgm_sys_dept d on u.dept_id = d.id_
        where u.is_del=0
        <if test="id != null">
            AND u.id_ = #{id}
        </if>
    </select>

    <!--查询用户列表-->
    <select id="selectUserPage" resultMap="BaseResultMap" parameterType="map">
        SELECT u.*,d.dept_name AS deptName
        FROM dgm_sys_user u LEFT JOIN dgm_sys_dept d ON u.dept_id = d.id_
        <where>
            u.is_del=0
            <if test="searchKey != null and searchKey != ''">
                AND (u.user_name LIKE "%"#{searchKey}"%" OR phone_ LIKE "%"#{searchKey}"%" OR account_ LIKE "%"#{searchKey}"%" )
            </if>
            <if test="enable != null and enable != ''">
                AND u.enable_ = #{enable}
            </if>
        </where>
    </select>

    <!--查询用户列表-->
    <select id="selectUserByRoleId" resultMap="BaseResultMap" parameterType="map">
        SELECT u.id_,u.user_name,u.account_,u.phone_,u.dept_id FROM dgm_sys_user u
        <where>
            u.is_del=0
            <if test="roleId != null and roleId != ''">
                and u.id_ in(select user_id from dgm_sys_user_role r where r.role_id=#{roleId} and r.is_del=0
                <if test="enable != null and enable != ''">
                    and r.enable_ = #{enable}
                </if>
                )
            </if>
            <if test="enable != null and enable != ''">
                AND u.enable_ = #{enable}
            </if>
        </where>
    </select>
</mapper>
